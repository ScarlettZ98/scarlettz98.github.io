# Dev Log - Oct 1, 2025

## Woolly Parlor Progress

Had quite the adventure today trying to get a proper isometric view and dealing with some seriously stubborn color issues. Also built a Wall class to go with yesterday's Floor system!

---

## What I Actually Built Today

### Wall Builder Class
Created a `Wall` class to match the Floor system:
- Takes length, width, height, and texture/color
- Automatically attaches bottom to floor level (y=0)
- Has positioning methods like `moveTo(x, z, floorY)` to place walls anywhere
- Includes a `resize()` method for dynamic wall sizing
- Proper texture tiling based on wall dimensions
- Same material system as Floor - handles colors, textures, or THREE.Texture objects

### Isometric Camera System
Switched from perspective to orthographic camera for true isometric view:
- No more perspective distortion - objects stay same size regardless of distance
- Fixed frustum sizing and aspect ratio handling
- Updated zoom to work with orthographic projection (adjusts frustum size instead of camera distance)
- Kept all the existing mouse rotation controls - they still work perfectly
- Window resize now properly updates the orthographic camera bounds

### Shadow System Improvements
Enhanced the lighting setup for better shadow quality:
- Configured directional light shadow camera with proper bounds (-20 to 20)
- Increased shadow map resolution to 2048x2048 for sharper edges
- Added shadow bias to eliminate "shadow acne" artifacts
- Secondary fill light to reduce harsh contrast while keeping shadows clean
- Only main light casts shadows to avoid conflicts

---

## The Great Color Crisis (This took way too long)

**The Problem**: Everything that wasn't red was showing up as grey or white, no matter what color I specified. Spent hours debugging this!

**Attempt 1 - Lighting Adjustments**: Thought it was the lighting being too bright, so I reduced ambient light, directional light intensity, and tone mapping exposure. Made things darker but colors still grey.

**Attempt 2 - Material Switching**: Switched from MeshLambertMaterial to MeshStandardMaterial with roughness/metalness properties. This made the problem worse - colors looked even more washed out.

**Attempt 3 - Tone Mapping**: Discovered ACES Filmic Tone Mapping was desaturating colors! Switched to NoToneMapping to preserve original colors. Better but still issues.

**Attempt 4 - MeshBasicMaterial**: Switched to MeshBasicMaterial which ignores lighting completely. Colors finally showed correctly but lost all shadows.

**The Real Culprit**: Hex colors with alpha channels! `#f3ff6bff` and `#2a2424ff` were causing THREE.js to parse colors incorrectly. Removed the alpha channel (`ff`) and switched back to MeshLambertMaterial.

**Final Solution**: 6-digit hex colors + MeshLambertMaterial + NoToneMapping = perfect colors with shadows!

---

## Technical Stuff That Drove Me Crazy

**Orthographic Zoom**: Had to completely rewrite the zoom logic. Perspective cameras zoom by moving closer/farther, but orthographic cameras zoom by changing the frustum size. Took a few tries to get the math right.

**Alpha Channel Confusion**: THREE.js apparently doesn't like 8-digit hex colors in the material color property. Should have caught this earlier but the error was silent - just defaulted to white.

**Material vs Lighting Balance**: Finding the sweet spot between accurate colors and proper shadows was tricky. MeshBasicMaterial = perfect colors but no shadows. MeshStandardMaterial = shadows but weird colors. MeshLambertMaterial + right settings = both!

**Shadow Camera Bounds**: Shadows were getting clipped because the default shadow camera frustum was too small. Had to manually set left/right/top/bottom bounds to cover the whole scene.

---

## What's Working Now

- True isometric view with orthographic camera
- All colors display accurately (light orange floor, red walls)
- Proper shadows cast by walls onto floor
- Zoom works correctly with frustum size adjustment
- Wall class creates walls at any position and size
- Both Floor and Wall classes support colors or textures
- No more color parsing issues with hex codes
- Sharp, clean shadows at 2048x2048 resolution

---

## What I Want to Add Next

**Surface Attachment System**: Thinking about a more sophisticated way to handle surfaces:
- Define "vertical surfaces" that can attach to walls (paintings, windows, doors)
- Define "horizontal surfaces" that can attach to floors/ceilings (rugs, lights, furniture)
- Maybe use a component system where surfaces know their parent and automatically position/resize
- Could have different surface types: decorative, functional, structural

**Enhanced Building Tools**:
- Click-and-drag wall placement
- Wall connection system (corners, intersections)
- Floor tile system instead of single large floors

**Material Management**:
- Texture library with previews
- Material inheritance (all walls use same material unless overridden)
- Better texture scaling and tiling controls

---

## Random Notes

- Orthographic view really does make everything feel more "architectural"
- The color debugging taught me way more about THREE.js materials than I wanted to know
- Wall positioning system with floor attachment is surprisingly intuitive
- Shadow quality improvement was totally worth the performance cost
- Keeping the mouse controls while switching camera types was the right call
- Next time I'll stick to 6-digit hex colors from the start

Pretty solid day despite the color headaches. The isometric view feels much more professional, and having both Floor and Wall classes gives me a good foundation for building more complex scenes. The surface attachment system idea could be really powerful for creating detailed interiors.
